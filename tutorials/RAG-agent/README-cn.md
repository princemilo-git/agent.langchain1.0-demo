



StateGraph 是 LangGraph 框架中的核心类，用于定义和管理基于状态的有向图工作流，特别适合构建需要动态逻辑、循环或条件分支的复杂应用程序，如智能 Agent、对话系统或检索增强生成（RAG）工作流。1

**核心概念与组件：** StateGraph 的工作流由状态（State）、节点（Nodes）和边（Edges）构成。状态是一个数据结构（通常使用 `typing.TypedDict` 定义），用于存储工作流的上下文信息并在节点间传递；节点是执行特定任务的函数（如调用 LLM 或处理数据），接收当前状态并返回更新后的状态；边定义节点间的执行顺序，支持无条件边（直接跳转）和条件边（根据状态动态选择路径）。12

**关键特性与优势：** StateGraph 的设计强调类型安全、状态隔离和灵活性，通过 `TypedDict` 或 Pydantic 模型确保数据结构正确性，并支持输入、输出和内部状态的分离，使内部处理细节对外部隐藏。它还允许节点读写任何已声明的状态字段，并支持运行时动态添加新字段。2

**基本使用步骤：** 
1. **定义状态结构**：创建一个继承 `TypedDict` 的类，指定工作流需要跟踪的字段。 
2. **创建 StateGraph 实例**：初始化 `StateGraph` 并传入状态类。 
3. **添加节点**：使用 `add_node` 方法将处理函数添加到图中。 
4. **配置边连接**：通过 `add_edge` 或 `add_conditional_edges` 定义节点执行顺序，包括设置入口点（`set_entry_point`）和出口点（`set_finish_point` 或使用 `END`）。 
5. **编译并运行**：调用 `compile()` 方法生成可执行图对象，使用 `invoke`、`stream` 或 `astream` 方法传入初始状态运行工作流。12

**高级功能与示例：** StateGraph 支持复杂逻辑如条件分支和循环，例如通过条件函数动态路由执行流程；它还与 LangChain 的 LLM、工具集成，并支持异步执行和运行时配置（如线程 ID 或用户 ID），便于多会话管理。